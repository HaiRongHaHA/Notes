# v8内存管理 
- 程序运行需要分配内存
- V8申请内存，分为**堆内存**和**栈内存**

## 栈
- 栈用于存放JS中的**基本类型**和**引用类型指针**
- 执行时创建，执行完毕销毁
- 栈空间是有限的，栈满则溢出抛错
- 栈空间连续，增删只需移动指针，操作速度快

### 执行上下文（栈）
- 执行完就销毁，不复杂，因此栈不需要垃圾回收

### 闭包
- 闭包不会引起栈溢出
- 不合理的使用闭包，会造成内存泄漏

## 堆
- 堆主要存储js中**引用类型数据**
- 空间不连续，占内存大
- 堆空间大小：64位系统 1.4g >= nodeV14 <= 2g
- 以下分类除新生代/老生代以外，其它的一般不需要回收

- new space——新生代
- old space——老生代
- Code space——运行时代码空间
- Large object space——大对象代码空间
- Map space——map空间


### new space——新生代
- 存放生命周期较短的对象数据

### old space——老生代
- 存放生命周期较长的对象数据
- 当new space的对象进行两个周期的垃圾回收后，如果数据还存在new space中，则将他们存放到old space中，old space又可以分为两部分，分别是Old pointer space和Old data space
- Old pointer space 存放GC后surviving的指针对象
- Old data space 存放GC后surviving的数据对象
- Old Space使用标记清除和标记整理的方式进行垃圾回收

### Code space——运行时代码空间
- 用于存放JIT已编译的代码
- 唯一拥有执行权限的内存

### Large object space——大对象代码空间
- 为了避免大对象的拷贝，使用该空间专门存储大对象
- GC 不会回收这部分内存

### Map space——map空间
- 存放对象的Map信息，即隐藏类，供v8内部使用
- 隐藏类是为了提升对象属性的访问速度的，提升编译速度的机制
- V8 会为每个对象创建一个隐藏类，记录了对象的属性布局，包括所有的属性和偏移量